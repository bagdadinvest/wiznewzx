{% extends "coderedcms/pages/web_page.html" %}
{% load wagtailcore_tags wagtailimages_tags coderedcms_tags static %}

{% block index_filters %}{% endblock %}
{% block index_content %}
{% if page.index_show_subpages %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-center">{{ self.title }}</h1>
    <p class="text-center">{{ self.search_description }}</p>

    <div class="row">
        {% for proposal in self.get_child_pages %}
            <div class="col-md-4 mb-4">
                <div class="card shadow-sm rounded proposal-card position-relative">
                    {% if proposal.cover_image %}
                        <img src="{{ proposal.cover_image.file.url }}" class="card-img-top" alt="{{ proposal.title }}">
                    {% else %}
                        <img src="{% static 'nopic.png' %}" class="card-img-top" alt="No image available">
                    {% endif %}

                    <!-- Tick Icon -->
                    <div class="tick-icon" style="display: none;">
                        <i class="fas fa-check-circle text-success"></i>
                    </div>

                    <div class="card-body">
                        <h5 class="card-title">{{ proposal.title }}</h5>
                        <p class="card-text">{{ proposal.caption|truncatewords:20 }}</p>
                        <p class="text-muted">
                            <small>Source: {{ proposal.source }}</small><br>
                            <small>Published on: {{ proposal.publication_date }}</small>
                        </p>
                        <a href="{{ proposal.url }}" class="btn btn-primary w-100">Read More</a>
                    </div>
                </div>
            </div>
        {% empty %}
            <p class="text-center">No proposals available at the moment.</p>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if self.paginated_pages.has_previous or self.paginated_pages.has_next %}
        <nav>
            <ul class="pagination justify-content-center">
                {% if self.paginated_pages.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ self.paginated_pages.previous_page_number }}">&laquo; Previous</a>
                    </li>
                {% endif %}

                {% for i in self.paginated_pages.paginator.page_range %}
                    <li class="page-item {% if self.paginated_pages.number == i %}active{% endif %}">
                        <a class="page-link" href="?page={{ i }}">{{ i }}</a>
                    </li>
                {% endfor %}

                {% if self.paginated_pages.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ self.paginated_pages.next_page_number }}">Next &raquo;</a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
</div>

<!-- Floating Popup for Selected Articles -->
<div id="selected-count-popup" class="position-fixed bottom-0 start-0 m-3 bg-light shadow-lg rounded p-3" style="display: none;">
    <p class="mb-0"><strong>Selected Articles: <span id="selected-count">0</span></strong></p>
</div>

{% endblock %}
{% endif %}
{% endblock %}

<style>
.proposal-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
}
.proposal-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}
.tick-icon {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 24px;
}
.selected .tick-icon {
    display: block;
}
.selected {
    border: 2px solid #28a745;
}
</style>
